---
name: codex-router
description: 将封闭的、自包含的编码子任务委派给 OpenAI Codex 执行以降低 Claude 使用成本。适用于纯算法、数据结构、数学计算、文本解析、编解码、正则、状态机等不依赖项目上下文的封闭编码问题。当开发中识别出可独立实现和验证的子任务时使用。
---

# Codex Router

将封闭的编码子任务路由给 Codex 执行，降低 Claude 使用成本。Claude 专注于规划、架构和需要广泛上下文的工作；Codex 处理自包含的实现问题。

## 前置条件

Codex CLI 需作为 MCP Server 接入。配置：

```json
{
  "mcpServers": {
    "codex": {
      "command": "codex",
      "args": ["mcp-server"]
    }
  }
}
```

## 何时委派

子任务**同时**满足以下条件时委派给 Codex：

1. **接口明确** — 可定义清晰的函数签名（输入类型、输出类型）
2. **自包含** — 不依赖项目其他模块的运行时状态或内部类型体系
3. **可独立测试** — 能编写独立测试验证正确性
4. **非平凡** — 有一定算法/逻辑复杂度，值得走委派流程

### 适合委派

算法实现、数据结构、数学/物理计算、解析器、编解码、正则/状态机、纯函数工具

### 不适合委派

需要项目架构理解、多模块协调、UI/UX 决策、调试重构

## 问题建模

将子任务格式化为以下结构后交给 Codex：

~~~
### 任务
[做什么，解决什么问题]

### 实现位置
[文件路径，函数名/类名]

### 语言
[编程语言]

### 接口
[参数类型、返回类型、错误处理约定]

### 约束
[性能要求、边界条件、特殊规则]

### 测试
[测试文件路径，需覆盖的用例，测试框架]

### 上下文（仅在必要时提供）
[最小化的类型定义、接口、常量——只提供 Codex 完成任务所必需的]
~~~

关键原则：

- **必须指定实现位置** — Codex 需要知道代码写在哪里
- **必须指定测试** — Codex 负责实现代码并通过测试，测试通过即视为完成
- **上下文最小化** — 只提供完成任务所必需的信息，不要给项目全貌

## 调用

通过 MCP `codex` 工具执行，参数固定：

| 参数 | 值 |
|------|-----|
| prompt | 格式化后的问题描述 |
| model | gpt-5.3-codex |
| approval-policy | never |
| sandbox | workspace-write |
| config | `{"model_reasoning_effort":"xhigh"}` |

不需要每次决策参数，始终使用以上配置。

## 结果处理

- Codex 完成 → 确认实现文件和测试文件已写入 → 继续主任务
- Codex 失败 → 直接由 Claude 接手完成，不重试
